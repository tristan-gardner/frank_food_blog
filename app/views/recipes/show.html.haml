#main
  %div.main_container
    %div.recipes
      %div.content_container
        %p=link_to octicon("chevron-left"), recipes_path
        %div.recipe_headers
          %div.main_title= "#{@recipe.name}"
          %div.user= "by: #{User.find(@recipe.user_id).username}"
        %div.edit_buttons
          - if user_signed_in?
            - if current_user.id == @recipe.user_id
              %h4
                =link_to octicon("pencil"), edit_recipe_path
                =link_to octicon("trashcan"), recipe_path, method: :delete
        -@recipe.images.each do |img|
          %div.image= image_tag(img, width: '700')
          -break
        %div.like_button_bar
          %h4
            =link_to octicon("thumbsup"), upvote_path(@recipe.id), :method => :post, :id => :upvote, :remote => true
            %span#upcount.text-success="#{@recipe.upvotes}"
            =link_to octicon("thumbsdown"), downvote_path(@recipe.id), :method => :post, :id => :downvote, :remote => true
            %span#downcount.text-danger="#{@recipe.downvotes}"
        %br
        -if !@recipe.ingredients.empty?
          %div.ingredients
            Ingredients
            %br
            -@recipe.ingredients.each do |ingredient|
              = "- #{ingredient.name}"
              %br
          %br
        %div.directions
          Directions:
          %br
          = "#{@recipe.directions}"
        %br
        %div.calories= "Calories: #{@recipe.calories}"
        %br
      %div.subtitle
        Reviews
      %div.content_container
        %br
        - count = 1
        -@recipe.reviews.each do |review|
          = "Reviewed by #{User.find(review.user_id).username}"
          %br
          = review.description
          %br
          = "#{review.rating}/5"
          %br
          %br
          -if count == 3
            -break
          -count += 1
        = form_for :review, :url => add_review_path(@recipe.id), :method => :post, :id => :add_review, :remote => true, :class => "btn btn-primary" do |f|
          %div.field= f.label :description
          = f.text_field :description

          %div.field= f.label :rating
          = f.number_field :rating, min: 0, max: 10

          = f.hidden_field :recipe_id, :value => params["recipe_id"]

          = f.hidden_field :user_id, :value => current_user.id

          %br
          %br
          %div= submit_tag "Submit Review", :class => 'btn btn-info'

        -# %p=link_to "Submit Review", add_review_path(@recipe.id), :method => :post, :id => :add_review, :remote => true, :class => "btn btn-primary"
        %p=link_to "View all reviews", reviews_path << "?recipe_id=#{@recipe.id}"

      -if @similar
        %div.subtitle
          Related Recipes
        %div.content_container
          %br
          %div.title= link_to "#{@similar.name}", recipe_path(@similar)
          %div.user= link_to "by: #{User.find(@similar.user_id).username}", user_path(@similar.user_id)
          -@similar.images.each do |img|
            %div.image= image_tag(img, width: '300')
            -break
          -union = (@recipe.ingredients + @similar.ingredients).uniq
          -diff = (@recipe.ingredients - @similar.ingredients | @similar.ingredients - @recipe.ingredients)
          -intersection = union - diff
          %div.ingredients= "Has #{intersection.size} common #{"ingredient".pluralize(intersection.size)}"
          %br
